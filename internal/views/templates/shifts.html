{{define "content"}}
<div class="container mx-auto p-6" x-data="{ openShiftModal: false, closeShiftModal: false }">
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-2xl font-bold text-gray-800">Gestión de Caja</h1>
        {{if .CurrentShift}}
        <button @click="closeShiftModal = true" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded transition duration-150 ease-in-out">
            Cerrar Caja
        </button>
        {{else}}
        <button @click="openShiftModal = true" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded transition duration-150 ease-in-out">
            Abrir Caja
        </button>
        {{end}}
    </div>

    {{if .CurrentShift}}
    <div class="bg-white rounded-lg shadow-lg mb-8 p-6 border-l-4 border-green-500">
        <h2 class="text-xl font-bold text-gray-800 mb-4">Turno Actual (Abierto)</h2>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div>
                <p class="text-sm text-gray-500">Hora de Inicio</p>
                <p class="text-lg font-medium text-gray-900">{{.CurrentShift.StartTime.Format "02/01/2006 15:04:05"}}</p>
            </div>
            <div>
                <p class="text-sm text-gray-500">Fondo Inicial</p>
                <p class="text-lg font-medium text-gray-900">{{formatMoney .CurrentShift.StartCash}}</p>
            </div>
            <div>
                <p class="text-sm text-gray-500">Notas</p>
                <p class="text-base text-gray-700">{{if .CurrentShift.Notes}}{{.CurrentShift.Notes}}{{else}}-{{end}}</p>
            </div>
        </div>
    </div>
    {{end}}

    <div class="bg-white shadow-md rounded-lg overflow-hidden">
        <div class="p-6 border-b border-gray-200">
            <h2 class="text-lg font-bold text-gray-800">Historial de Turnos</h2>
        </div>
        <div class="overflow-x-auto">
            <table class="min-w-full table-auto">
                <thead>
                    <tr class="bg-gray-100 text-gray-600 uppercase text-xs leading-normal">
                        <th class="py-3 px-6 text-left font-semibold">Inicio</th>
                        <th class="py-3 px-6 text-left font-semibold">Fin</th>
                        <th class="py-3 px-6 text-right font-semibold">Fondo Inicial</th>
                        <th class="py-3 px-6 text-right font-semibold">Declarado</th>
                        <th class="py-3 px-6 text-right font-semibold">Diferencia</th>
                        <th class="py-3 px-6 text-center font-semibold">Estado</th>
                    </tr>
                </thead>
                <tbody class="text-gray-700 text-sm font-light">
                    {{range .Shifts}}
                    <tr class="border-b border-gray-200 hover:bg-gray-50 transition duration-150">
                        <td class="py-3 px-6 text-left whitespace-nowrap">
                            {{.StartTime.Format "02/01/2006 15:04"}}
                        </td>
                        <td class="py-3 px-6 text-left whitespace-nowrap">
                            {{if .EndTime}}{{.EndTime.Format "02/01/2006 15:04"}}{{else}}-{{end}}
                        </td>
                        <td class="py-3 px-6 text-right font-medium">
                            {{formatMoney .StartCash}}
                        </td>
                        <td class="py-3 px-6 text-right font-medium">
                            {{if .EndCashDeclared}}{{formatMoney .EndCashDeclared}}{{else}}-{{end}}
                        </td>
                        <td class="py-3 px-6 text-right font-bold {{if and .Difference (lt (derefFloat .Difference) 0.0)}}text-red-600{{else}}text-green-600{{end}}">
                            {{if .Difference}}{{formatMoney .Difference}}{{else}}-{{end}}
                        </td>
                        <td class="py-3 px-6 text-center">
                            <span class="py-1 px-3 rounded-full text-xs font-semibold
                                {{if eq .Status "open"}}bg-green-100 text-green-700 border border-green-200{{else}}bg-gray-100 text-gray-700 border border-gray-200{{end}}">
                                {{if eq .Status "open"}}Abierto{{else}}Cerrado{{end}}
                            </span>
                        </td>
                    </tr>
                    {{end}}
                    {{if not .Shifts}}
                    <tr>
                        <td colspan="6" class="py-8 text-center text-gray-500 italic bg-gray-50">
                            No hay historial de turnos.
                        </td>
                    </tr>
                    {{end}}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Pagination -->
    <div class="flex justify-between items-center mt-6">
        {{if gt .Page 1}}
        <a href="/shifts?page={{.PrevPage}}" class="flex items-center bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 font-medium py-2 px-4 rounded transition duration-150">
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
            Anterior
        </a>
        {{else}}
        <div></div>
        {{end}}

        {{if .Shifts}} 
        <a href="/shifts?page={{.NextPage}}" class="flex items-center bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 font-medium py-2 px-4 rounded transition duration-150">
            Siguiente
            <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
        </a>
        {{end}}
    </div>

    <!-- Open Shift Modal -->
    <div x-show="openShiftModal" style="display: none;" class="fixed inset-0 z-50 overflow-y-auto" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" aria-hidden="true" @click="openShiftModal = false"></div>
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
            <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
                <form action="/shifts/open" method="POST">
                    <input type="hidden" name="gorilla.csrf.Token" value="{{.CSRFToken}}">
                    <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                        <h3 class="text-lg leading-6 font-medium text-gray-900" id="modal-title">Abrir Caja</h3>
                        <div class="mt-4 space-y-4">
                            <div>
                                <label for="start_cash" class="block text-sm font-medium text-gray-700">Fondo Inicial ($)</label>
                                <input type="number" name="start_cash" id="start_cash" step="0.01" required class="mt-1 focus:ring-blue-500 focus:border-blue-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">
                            </div>
                            <div>
                                <label for="open_notes" class="block text-sm font-medium text-gray-700">Notas (Opcional)</label>
                                <textarea name="notes" id="open_notes" rows="2" class="mt-1 focus:ring-blue-500 focus:border-blue-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md"></textarea>
                            </div>
                        </div>
                    </div>
                    <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                        <button type="submit" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:ml-3 sm:w-auto sm:text-sm">
                            Abrir
                        </button>
                        <button type="button" @click="openShiftModal = false" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                            Cancelar
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Close Shift Modal -->
    <div x-show="closeShiftModal" style="display: none;" class="fixed inset-0 z-50 overflow-y-auto" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" aria-hidden="true" @click="closeShiftModal = false"></div>
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
            <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
                <form action="/shifts/close" method="POST">
                    <input type="hidden" name="gorilla.csrf.Token" value="{{.CSRFToken}}">
                    <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                        <h3 class="text-lg leading-6 font-medium text-gray-900" id="modal-title">Cerrar Caja</h3>
                        <div class="mt-4 space-y-4">
                            <div>
                                <label for="end_cash_declared" class="block text-sm font-medium text-gray-700">Efectivo en Caja ($) - Declarado</label>
                                <input type="number" name="end_cash_declared" id="end_cash_declared" step="0.01" required class="mt-1 focus:ring-blue-500 focus:border-blue-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">
                                <p class="mt-1 text-xs text-gray-500">Cuenta el dinero físico y escribe el total.</p>
                            </div>
                            <div>
                                <label for="close_notes" class="block text-sm font-medium text-gray-700">Notas (Opcional)</label>
                                <textarea name="notes" id="close_notes" rows="2" class="mt-1 focus:ring-blue-500 focus:border-blue-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md"></textarea>
                            </div>
                        </div>
                    </div>
                    <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                        <button type="submit" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:ml-3 sm:w-auto sm:text-sm">
                            Cerrar Turno
                        </button>
                        <button type="button" @click="closeShiftModal = false" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                            Cancelar
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{{end}}
