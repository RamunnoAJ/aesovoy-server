{{define "quick_category_modal"}}
<div x-data="{ 
        open: false, 
        type: '{{.Type}}',
        targetId: '{{.TargetID}}'
     }"
     @open-quick-category-modal.window="if ($event.detail.type === type) open = true"
     x-show="open"
     class="fixed inset-0 z-50 overflow-y-auto"
     style="display: none;">
    
    <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" @click="open = false"></div>

    <div class="flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0">
        <div class="relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg">
            <form id="quick-create-{{.Type}}-form"
                  hx-post="{{.PostURL}}"
                  hx-target="#{{.TargetID}}"
                  hx-swap="beforeend"
                  @htmx:after-request="if(event.detail.successful) { 
                        open = false; 
                        $dispatch('showToast', {message: 'Categoría creada con éxito', type: 'success'});
                        $el.reset();
                        
                        // Force update the select value to the new option
                        setTimeout(() => {
                            const select = document.getElementById(targetId);
                            if (select && select.lastElementChild) {
                                select.value = select.lastElementChild.value;
                                select.dispatchEvent(new Event('change'));
                            }
                        }, 100);
                   }">
                
                <div class="bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4">
                    <h3 class="text-base font-semibold leading-6 text-gray-900">Nueva Categoría ({{if eq .Type "product"}}Producto{{else}}Proveedor{{end}})</h3>
                    <div class="mt-4 space-y-4">
                        <div>
                            <label for="quick-name-{{.Type}}" class="block text-sm font-medium leading-6 text-gray-900">Nombre</label>
                            <input type="text" name="name" id="quick-name-{{.Type}}" required class="mt-1 block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-sm sm:leading-6 px-3">
                        </div>
                        {{if eq .Type "product"}}
                        <div>
                            <label for="quick-desc-{{.Type}}" class="block text-sm font-medium leading-6 text-gray-900">Descripción</label>
                            <textarea name="description" id="quick-desc-{{.Type}}" rows="2" class="mt-1 block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-sm sm:leading-6 px-3"></textarea>
                        </div>
                        {{end}}
                    </div>
                </div>
                <div class="bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6">
                    <button type="submit" class="inline-flex w-full justify-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-500 sm:ml-3 sm:w-auto">Guardar</button>
                    <button type="button" @click="open = false" class="mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto">Cancelar</button>
                </div>
            </form>
        </div>
    </div>
</div>
{{end}}
